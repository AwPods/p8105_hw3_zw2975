---
title: "p8105_hw3_zw2975"
author: "Zhiyu Wei"
date: 2024-10-14
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
```


## Problem 1

```{r import dataset 1}
# Import data
library(p8105.datasets) 
data("ny_noaa")
```
#### short descirption of the dataset:
The `ny_noaa` dataset has variables `id`, `date`, `prcp`, `snow`,`snwd`, `tamx`, and `tmin`. 

This dataset has `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns.

Missing date should not impact the analysis result drastically since there are already too many missing values for `tmin`, `tmax`, `snow`, and `snwd`.

#### Clean ny_noaa
```{r clean data}
# make dates cleaner
ny_noaa <- ny_noaa %>%
mutate(year = year(date), month = month(date), day = day(date))

# relocate the variables and rename them
ny_noaa <- ny_noaa %>%
  relocate(year, month, day) %>%
  rename(precip = prcp, snowfall = snow, snowdepth = snwd) %>%
  relocate(id)

# commonly observed value for snowfall
ggplot(ny_noaa, aes(x = snowfall)) + 
  geom_histogram() +
  labs (title = "snow fall distribution",
        x = "snow fall (mm)",
        y = "count in observation") 
```
##### According to the histogram of snowfall, the most commonly observed value for snowfall is 0 mm.

#### panel plots
```{r panel plot}
# in January
ny_noaa|>
     group_by(id) |>
  filter(month == 1) |>
  summarize(mean_jan = mean(tmax, na.rm = TRUE))|>
  ggplot(aes(x = id, y= mean_jan )) +
  labs(title = "January max temperature",
       ylab = "Temperature (in tenths)",
       xlab = "station id")
```

#### panel plots 2
```{r panel plots 2}
# takes a long time the process the data, need to get rid of NAs
ny_noaa2 <- ny_noaa |>
  filter(!is.na(tmax), !is.na(tmin))

ggplot(ny_noaa2, aes(x = tmax)) +
  geom_density(fill = "blue", alpha = 0.5) +
  ggtitle("Density Plot for max temperature") +
  xlab("tmax") +
  ylab("Density")

# Density plot for tmin
ggplot(ny_noaa2, aes(x = tmin)) +
  geom_density(fill = "red", alpha = 0.5) +
  ggtitle("Density Plot for minimum temperature") +
  xlab("tmin") +
  ylab("Density")

ggplot(ny_noaa2) +
  geom_density(aes(x = tmax, fill = "tmax"), alpha = 0.5) +
  geom_density(aes(x = tmin, fill = "tmin"), alpha = 0.5) +
  scale_fill_manual(values = c("tmax" = "blue", "tmin" = "red")) +
  ggtitle("Combined Density Plot for tmax and tmin") +
  xlab("Temperature") +
  ylab("Density")

```


## Problem 2
```{r p2 datasets}
acceler = read.csv("./data/nhanes_accel.csv")
demog = read.csv("./data/nhanes_covar.csv")
```

#### data cleaning
```{r p2 data cleaning}
# column names for the demographic dataset on 4th row
colnames(demog)<-demog[4,]

# get rid of useless rows
demog <- demog[5:254,]

# clean names 
demog<-janitor::clean_names(demog)
acceler <- janitor::clean_names(acceler)

demog <- demog |>
 mutate(sex = if_else(sex == 1, "male",
                      if_else( sex == 2, "female",
                      NA_character_)))|>
          mutate(education = if_else(education == 1,"less han high school" ,
                                     if_else(education == 2, "high school equivalent",
                                     if_else(education == 3, "more than high school", NA_character_))))
                  
# get rid of missing demographic data
demog <- demog |>
  na.omit()
  
# change acceler dataset "seqn" to a character variable
acceler <- acceler |>
  mutate(seqn = as.character(seqn))

# merge 2 datasets
nhanes <- inner_join (demog, acceler, by = "seqn")

# get rid of people under 21
nhanes <- nhanes |>
  filter(age >= 21)

```


#### table for number of men and women
```{r table}
# sex as rows, education level as columns
table(nhanes$sex, nhanes$education)
```


#### visualization of age distibution
```{r histogram}
nhanes |>
  ggplot(aes(x = age)) +
  geom_bar(aes(color = sex),position = "dodge", alpha = .5) +
   facet_wrap(~education) +
   scale_x_discrete(
    breaks =c(21,30,40,50,60,70,80)) 
```


#### total activity against age
```{r new variable}
# new variable: total activity
nhanes <- nhanes |>
mutate(total_activity = (rowSums(nhanes[, 6:ncol(nhanes)], na.rm = TRUE)))
```

```{r scatterplot}

ggplot(nhanes, aes(x = age, y = total_activity)) +
geom_point(aes(color = sex), alpha = .5)+
  geom_smooth(method = smooth, se = FALSE) +
  facet_wrap(~education) +
  labs(
    title = "Total activity vs. age by gender and education level",
    x = "age",
    y = "total activity",
    color = "sex")+
  scale_x_discrete(
    breaks =c(21, 40, 60, 80)) # I want more readable x axis numbers
```
