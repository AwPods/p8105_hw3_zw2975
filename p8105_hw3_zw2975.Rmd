---
title: "p8105_hw3_zw2975"
author: "Zhiyu Wei"
date: 2024-10-14
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(patchwork)
```


## Problem 1

```{r import dataset 1}
# Import data
library(p8105.datasets) 
data("ny_noaa")
```
#### short descirption of the dataset:
The `ny_noaa` dataset has variables `id`, `date`, `prcp`, `snow`,`snwd`, `tamx`, and `tmin`. 

This dataset has `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns.

Missing date should not impact the analysis result drastically since there are already too many missing values for `tmin`, `tmax`, `snow`, and `snwd`.

#### Clean ny_noaa
```{r clean data, warning = FALSE}
# make dates cleaner
ny_noaa <- ny_noaa %>%
mutate(year = year(date), month = month(date), day = day(date))

# character to numeric, integer to numeric
ny_noaa <- ny_noaa %>%
  mutate(tmin = as.numeric(tmin)) %>%
  mutate(tmax= as.numeric (tmax)) %>%
  mutate(snow = as.numeric(snow)) %>%
  mutate(snwd = as.numeric(snwd)) %>%
  mutate(prcp = as.numeric(prcp))


# relocate the variables and rename them
ny_noaa <- ny_noaa %>%
  relocate(year, month, day) %>%
  rename(precip = prcp, snowfall = snow, snowdepth = snwd) %>%
  relocate(id)


# commonly observed value for snowfall
ggplot(ny_noaa, aes(x = snowfall)) + 
  geom_histogram() +
  labs (title = "snow fall distribution",
        x = "snow fall (mm)",
        y = "count in observation") 


```
##### According to the histogram of snowfall, the most commonly observed value for snowfall is 0 mm.

#### panel plots
```{r panel plot}

# in January
ny_noaa|>
  filter(!is.na (tmax)) |> #no need to include na obs
  filter(month == 1) |>
  ggplot(aes(x = year, y= tmax )) +
  labs(title = "January max temperature",
       ylab = "Temperature (in tenths)",
       xlab = "year") +
  facet_wrap(~id)
```

#### panel plots 2
```{r panel plots 2}
# takes a long time the process the data, need to get rid of NAs
ny_noaa2 <- ny_noaa |>
  filter(!is.na(tmax), !is.na(tmin))

ggplot(ny_noaa2, aes(x = tmax)) +
  geom_density(fill = "blue", alpha = 0.5) +
  ggtitle("Density Plot for max temperature") +
  xlab("tmax") +
  ylab("Density")

# Density plot for tmin
ggplot(ny_noaa2, aes(x = tmin)) +
  geom_density(fill = "red", alpha = 0.5) +
  ggtitle("Density Plot for minimum temperature") +
  xlab("tmin") +
  ylab("Density")

# density plot for both
ggplot(ny_noaa2) +
  geom_density(aes(x = tmax, fill = "tmax"), alpha = 0.5) +
  geom_density(aes(x = tmin, fill = "tmin"), alpha = 0.5) +
  scale_fill_manual(values = c("tmax" = "blue", "tmin" = "red")) +
  ggtitle("Combined Density Plot for tmax and tmin") +
  xlab("Temperature") +
  ylab("Density")

```


## Problem 2
```{r p2 datasets}
acceler = read.csv("./data/nhanes_accel.csv")
demog = read.csv("./data/nhanes_covar.csv")
```

#### data cleaning
```{r p2 data cleaning}
# column names for the demographic dataset on 4th row
colnames(demog)<-demog[4,]

# get rid of useless rows
demog <- demog[5:254,]

# clean names 
demog<-janitor::clean_names(demog)
acceler <- janitor::clean_names(acceler)

demog <- demog |>
 mutate(sex = if_else(sex == 1, "male",
                      if_else( sex == 2, "female",
                      NA_character_)))|>
          mutate(education = if_else(education == 1,"less than high school" ,
                                     if_else(education == 2, "high school equivalent",
                                     if_else(education == 3, "more than high school", NA_character_))))
                  
# get rid of missing demographic data
demog <- demog |>
  na.omit()
  
# change acceler dataset "seqn" to a character variable
acceler <- acceler |>
  mutate(seqn = as.character(seqn))

# merge 2 datasets
nhanes <- inner_join (demog, acceler, by = "seqn")

# get rid of people under 21
nhanes <- nhanes |>
  filter(age >= 21)


# age needs to be numeric
nhanes <- nhanes |>
  mutate(age = as.numeric(age))

```


#### table for number of men and women
```{r table}
# sex as rows, education level as columns
table(nhanes$sex, nhanes$education)
```


#### visualization of age distibution
```{r histogram}
nhanes |>
  ggplot(aes(x = age)) +
  geom_bar(aes(color = sex),position = "dodge", alpha = .5) +
   facet_wrap(~education) 

```
##### Comment
From the table, we can see that the dataset have more participants who received education more than high school level. For male, there are more participants who received high school equivalent education compared to female. 
The age distribution graph also reflects on the numbers from the table. The more than high school education category has the most observations and participants who age younger tend to fall into this education level. The age distribution for less than high school and high school equivalent education levels have very similar.


#### total activity against age
```{r new variable}
# new variable: total activity
nhanes <- nhanes |>
mutate(total_activity = (rowSums(nhanes[, 6:ncol(nhanes)], na.rm = TRUE)))
```

```{r scatterplot}

ggplot(nhanes, aes(x = age, y = total_activity)) +
geom_point(aes(color = sex), alpha = .5)+
  geom_smooth(method = "lm", se=FALSE, aes(color = sex)) +
  facet_grid(.~education) +
  labs(
    title = "Total activity vs. age by gender and education level",
    x = "age",
    y = "total activity",
    color = "sex") # I want more readable x axis numbers
```

##### Comment
Same as what we observed in the previous graphs, this scatter plot also shows more participants falling into the more than high school education level. However, the total activity of participants across the 3 education level does not seem to have big difference. There is one very obvious outlier for more than high school education level, which is a male participant who almost have 0 total activity minutes. 

When we look at the trend lines, both female and male tend to have a negative trend of age vs. total activity time and they have very similar slope. 

#### 3 panel plot
```{r 3 panel plot}
# step 1: pivot longer 

long =nhanes |>
  pivot_longer (
    "min1":"min1440",
    names_to = "min",
    values_to = "activity") |>
  select(seqn, sex, min, activity,education )

# step 2: mutate the min variable to make it numeric

long <- long |>
  mutate(min = as.numeric(gsub("min", "", min)))

# step 3: plot the 3-panel plot

long |>
  ggplot(aes (x = min, y = activity, color = sex))+
  geom_point(alpha = 0.05) + # increase the opacity of points to make the lines stand out
  geom_smooth(se = FALSE, linewidth= 2) +
  theme(legend.position = "bottom") +
  labs(title = "24 hrs activity by education levels",
       x = "minute (over 24 hrs)") +
  facet_grid(.~education)
```
##### comment
For every education level, the line all appears to be declining and increasing then declining to reflect a person's activity level during the 24 hrs period. During the middle of the day, which is around 500 minutes, the smooth trend line roughly reaches its maximum since it is around 10 am in the morning. When the line reaches somewhere over 1000 minutes, it starts declining, reflecting the end of work hours. 


